{% extends 'admin_layout.html' %}

{% block css %}

    <style type="text/css">

        .btn-control {
            padding: 0px 5px;
            margin-left: 10px;
        }

        .loading {
            position: fixed;
            width: 32px;
            height: 32px;
            left: 50%;
            top: 50%;
            margin-left: -16px;
            margin-top: -16px;
            background-image: url("/static/img/loading.gif");
        }

        .hide {
            display: none;
        }

    </style>


{% endblock %}


{% block content %}

    <!-- Start content-page -->
    <div class="content-page">

        <!-- Start content-bar -->
        <div class="content">

            <div class="container-fluid">

                <div class="row">
                    <div class="col-xl-12">
                        <div class="breadcrumb-holder">
                            <h1 class="main-title float-left">党内统计-党员数据</h1>
                            <ol class="breadcrumb float-right">
                                <li class="breadcrumb-item"></li>
                                <li class="breadcrumb-item active"></li>
                            </ol>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                </div>
                <!-- end row -->
                <input style="display: none" id="idd" value="">
                <div class="row">

                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                        <div class="card mb-3">
                            <div class="card-header">
                                <i class="fa fa-table"></i> 会议统计 -
                                <span id="meetingTag">{{ meeting_year }}年</span>
                                <div style="float: right">
                                    <span>&nbsp;&nbsp;&nbsp;其他年份:</span>

                                    <select id="idMeeting">
                                        {% for item in year_meeting %}
                                            <option>{{ item }}</option>
                                        {% endfor %}
                                    </select>
                                    <button class="btn btn-secondary btn-sm btn-control" onclick="meetingSearch()">查询
                                    </button>
                                </div>
                            </div>

                            <div class="card-body">
                                <iframe class="chartjs-hidden-iframe" tabindex="-1"
                                        style="display: block; overflow: hidden; border: 0px; margin: 0px; top: 0px; left: 0px; bottom: 0px; right: 0px; height: 100%; width: 100%; position: absolute; pointer-events: none; z-index: -1;"></iframe>
                                <canvas id="meetingChart" width="1034" height="516"
                                        style="display: block; height: 258px; width: 517px;"></canvas>
                            </div>

                        </div><!-- end card-->
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                        <div class="card mb-3">
                            <div class="card-header">
                                <i class="fa fa-table"></i> 党课统计 -
                                <span id="lectureTag">{{ lecture_year }}年</span>
                                <div style="float: right">
                                    <span>&nbsp;&nbsp;&nbsp;其他年份:</span>

                                    <select id="idLeture">
                                        {% for item in year_lecture %}
                                            <option>{{ item }}</option>
                                        {% endfor %}
                                    </select>
                                    <button class="btn btn-secondary btn-sm btn-control" onclick="lectureSearch()">查询
                                    </button>
                                </div>
                            </div>

                            <div class="card-body">
                                <iframe class="chartjs-hidden-iframe" tabindex="-1"
                                        style="display: block; overflow: hidden; border: 0px; margin: 0px; top: 0px; left: 0px; bottom: 0px; right: 0px; height: 100%; width: 100%; position: absolute; pointer-events: none; z-index: -1;"></iframe>
                                <canvas id="lectureChart" width="1034" height="516"
                                        style="display: block; height: 258px; width: 517px;"></canvas>
                            </div>

                        </div><!-- end card-->
                    </div>

                </div>
                <div class="row">


                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-3">
                        <div class="card mb-3">
                            <div class="card-header">
                                <i class="fa fa-table"></i> 党员数据
                            </div>

                            <div class="card-body">
                                <canvas id="memberChart"></canvas>
                            </div>
                        </div><!-- end card-->
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-3">
                        <div class="card mb-3">
                            <div class="card-header">
                                <i class="fa fa-table"></i> 党员性别数据
                            </div>

                            <div class="card-body">
                                <canvas id="memberGenderChart"></canvas>
                            </div>
                        </div><!-- end card-->
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-3">
                        <div class="card mb-3">
                            <div class="card-header">
                                <i class="fa fa-table"></i> 党员积极分子数据
                            </div>

                            <div class="card-body">
                                <canvas id="maChart"></canvas>
                            </div>
                        </div><!-- end card-->
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-3">
                        <div class="card mb-3">
                            <div class="card-header">
                                <i class="fa fa-table"></i> 党员积极分子性别数据
                            </div>

                            <div class="card-body">
                                <canvas id="maGenderChart"></canvas>
                            </div>
                        </div><!-- end card-->
                    </div>

                </div>
            </div>


        </div>
        <div class="loading hide" id="loading"></div>
        <!-- END content-bar -->

    </div>
    <!-- End content-page -->

{% endblock %}


{% block js %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>

    <script>
        //页面首次访问时的绘图
        var dataMeeting = {{ data_meeting|safe }};
        var dataLecture = {{ data_lecture|safe }};
        var meeting = 'meetingChart';
        var lecture = 'lectureChart';
        var labelMeeting = '会议次数';
        var labelLecture = '党课次数';

        var numMember = {{ data_num.num_member|safe }};
        var numMemberGender = {{ data_num.num_member_gender|safe }};
        var numMemberActivist = {{ data_num.num_member_activist|safe }};
        var numMemberActivistGender = {{ data_num.num_member_activist_gender|safe }};

        drawChart(dataMeeting, meeting, labelMeeting);
        drawChart(dataLecture, lecture, labelLecture);
        drawMemberChart(numMember);
        drawMemberGenderChart(numMemberGender);
        drawMaChart(numMemberActivist);
        drawMaGenderChart(numMemberActivistGender);


        // 会议统计和党课统计绘图
        function drawChart($data, $id, $label) {
            //获取id
            var ctx1 = document.getElementById($id).getContext('2d');

            var barChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ["1月", "2月", "3月", "4月", "5月", "6月", "7月", "8月", "9月", "10月", "11月", "12月"],
                    datasets: [{
                        label: $label,
                        data: $data,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)',
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255,99,132,1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(255,99,132,1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });

        }


        // 党员数据绘图
        function drawMemberChart($numMember) {
            var ctx3 = document.getElementById("memberChart").getContext('2d');
            var memberChart = new Chart(ctx3, {
                type: 'pie',
                data: {
                    datasets: [{
                        data: $numMember,
                        backgroundColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)'
                        ],
                        label: 'Dataset 1'
                    }],
                    labels: [
                        "正式党员",
                        "预备党员"
                    ]
                },
                options: {
                    responsive: true
                }
            });
        }


        // 党员性别数据绘图
        function drawMemberGenderChart($numMemberGender) {
            var ctx4 = document.getElementById("memberGenderChart").getContext('2d');
            var memberGenderChart = new Chart(ctx4, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: $numMemberGender,
                        backgroundColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255,99,132,1)'
                        ],
                        label: 'Dataset 1'
                    }],
                    labels: [
                        "男生",
                        "女生"
                    ]
                },
                options: {
                    responsive: true
                }
            });
        }


        // 党员积极分子数据绘图
        function drawMaChart($numMemberActivist) {
            var ctx5 = document.getElementById("maChart").getContext('2d');
            var maChart = new Chart(ctx5, {
                type: 'pie',
                data: {
                    datasets: [{
                        data: $numMemberActivist,
                        backgroundColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        label: 'Dataset 1'
                    }],
                    labels: [
                        "正式党员",
                        "预备党员",
                        "积极分子"
                    ]
                },
                options: {
                    responsive: true
                }

            });
        }


        // 党员积极分子性别数据绘图
        function drawMaGenderChart($numMemberActivistGender) {
            var ctx6 = document.getElementById("maGenderChart").getContext('2d');
            var maGenderChart = new Chart(ctx6, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: $numMemberActivistGender,
                        backgroundColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255,99,132,1)'
                        ],
                        label: 'Dataset 1'
                    }],
                    labels: [
                        "男生",
                        "女生"
                    ]
                },
                options: {
                    responsive: true
                }
            });
        }


    </script>

    <script>

        //获取url参数函数
        function getUrlParameter(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                if (pair[0] == variable) {
                    return pair[1];
                }
            }
            return (false);
        }


        function meetingSearch() {
            $('#loading').removeClass('hide')
            var yearMeeting = $('#idMeeting').val()
            var lyear = getUrlParameter('lyear')
            if (lyear == '') {
                var today = new Date();//获得当前日期
                var lyear = today.getFullYear();//获得年份
            }

            window.location.href = "/admin_party_statistics/?myear=" + yearMeeting + "&lyear=" + lyear;
        }

        function lectureSearch() {
            $('#loading').removeClass('hide')
            var yearLecture = $('#idLeture').val()
            var myear = getUrlParameter('myear')
            if (myear == '') {
                var today = new Date();//获得当前日期
                var myear = today.getFullYear();//获得年份
            }
            window.location.href = "/admin_party_statistics/?myear=" + myear + "&lyear=" + yearLecture;
        }

    </script>

{% endblock %}